<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="WhatTheySaid.News - Accountability Through Quotes">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="/manifest.json">
  <title>WhatTheySaid.News</title>
  <link rel="stylesheet" href="/css/styles.css?v=27">
  <link rel="stylesheet" href="/css/fact-check-widget.css?v=1">
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8204858761090995"
       crossorigin="anonymous"></script>
</head>
<body>
  <div id="app">
    <header>
      <div class="date-ribbon">
        <span id="date-ribbon-text"></span>
      </div>
      <nav>
        <div class="logo-group">
          <a href="/" class="logo" onclick="navigate(event, '/')">WhatTheySaid.News</a>
          <span class="logo-subhead">Accountability Through Quotes</span>
        </div>
        <div class="nav-links">
          <div class="header-search">
            <button class="search-icon-btn" onclick="toggleSearchBox()" aria-label="Search">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/>
              </svg>
            </button>
            <div class="search-box-expanded" id="search-box-expanded" style="display:none">
              <input type="search" id="header-search-input" placeholder="Search quotes, authors, topics..." class="search-input" onkeydown="onSearchKeydown(event)" oninput="onSearchInput()">
              <button class="search-close-btn" onclick="toggleSearchBox()" aria-label="Close search">&times;</button>
              <div class="search-autocomplete-dropdown" id="search-autocomplete-dropdown"></div>
            </div>
          </div>
          <a href="/" onclick="navigate(event, '/')">Home</a>
          <a href="/analytics" onclick="navigate(event, '/analytics')">Analytics</a>
          <a href="https://buymeacoffee.com/whattheysaidnews" target="_blank" rel="noopener" class="nav-support-link">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            Support
          </a>
          <a href="/review" id="nav-review" onclick="navigate(event, '/review')" class="nav-link-review" style="display: none;">
            Review
            <span class="review-badge" id="review-badge" style="display: none;">0</span>
          </a>
          <a href="/settings" id="nav-settings" onclick="navigate(event, '/settings')" style="display: none;">Settings</a>
          <a href="/login" id="nav-login" onclick="navigate(event, '/login')" style="display: none;">Login</a>
          <a href="#" id="nav-logout" onclick="logout(event)" style="display: none;">Logout</a>
        </div>
        <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle dark mode" title="Toggle dark mode">
          <svg class="theme-icon-light" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="5"/><path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
          </svg>
          <svg class="theme-icon-dark" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
        </button>
      </nav>
    </header>

    <main id="content">
      <!-- Content loaded by JS router -->
      <div class="loading">Loading...</div>
    </main>

    <!-- AdSense footer ad (public pages only) -->
    <div id="ad-container" class="ad-container" style="display: none;">
      <ins class="adsbygoogle"
           style="display:block"
           data-ad-client="ca-pub-8204858761090995"
           data-ad-slot=""
           data-ad-format="horizontal"
           data-full-width-responsive="true"></ins>
    </div>

    <footer>
      <div class="footer-inner">
        <div class="footer-brand">
          <span class="footer-logo">WhatTheySaid.News</span>
          <span class="footer-tagline">Accountability Through Quotes</span>
        </div>
        <div class="footer-links">
          <a href="/" onclick="navigate(event, '/')">Home</a>
          <a href="/login" onclick="navigate(event, '/login')">Admin</a>
        </div>
        <div class="footer-support">
          <span class="footer-support-text">Independently built. No ads, no tracking.</span>
          <a href="https://buymeacoffee.com/whattheysaidnews" target="_blank" rel="noopener" class="footer-support-btn">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none"><path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>
            Support This Project
          </a>
        </div>
        <div class="footer-copyright">
          &copy; 2026 WhatTheySaid.News / GGM, LLC.
        </div>
      </div>
    </footer>
  </div>

  <!-- Modal for log details -->
  <div id="modal-overlay" class="modal-overlay hidden" onclick="if(event.target===this)closeModal()">
    <div class="modal">
      <button class="modal-close" onclick="closeModal()">&times;</button>
      <div id="modal-content"></div>
    </div>
  </div>

  <button id="scroll-top-btn" class="scroll-top-btn" onclick="window.scrollTo({top:0,behavior:'smooth'})" aria-label="Scroll to top" style="display:none">
    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      <polyline points="18 15 12 9 6 15"/>
    </svg>
  </button>

  <div id="toast-container" class="toast-container"></div>

  <!-- Socket.IO for real-time updates -->
  <script src="/socket.io/socket.io.js"></script>

  <!-- Chart.js for analytics visualizations -->
  <script defer src="https://cdn.jsdelivr.net/npm/chart.js@4/dist/chart.umd.min.js"></script>

  <script src="/js/api.js?v=27"></script>
  <script src="/js/admin-actions.js?v=27"></script>
  <script src="/js/important.js?v=27"></script>
  <script src="/js/charts.js?v=27"></script>
  <script src="/js/analytics.js?v=27"></script>
  <script src="/js/home.js?v=27"></script>
  <script src="/js/quote.js?v=27"></script>
  <script src="/js/article.js?v=27"></script>
  <script src="/js/author.js?v=27"></script>
  <script src="/js/settings.js?v=27"></script>
  <script src="/js/review.js?v=27"></script>
  <script src="/js/logs.js?v=27"></script>
  <script src="/js/login.js?v=27"></script>
  <script src="/js/resetPassword.js?v=27"></script>
  <script src="/js/app.js?v=27"></script>

  <!-- Buy Me a Coffee floating widget -->
  <script
    data-name="BMC-Widget"
    data-id="whattheysaidnews"
    data-description="Support WhatTheySaid.News"
    data-message="Help keep this site free and ad-free"
    data-color="#E8596E"
    data-position="Right"
    data-x_margin="18"
    data-y_margin="18"
    src="https://cdnjs.buymeacoffee.com/1.0.0/widget.prod.min.js">
  </script>

  <script>
    let _searchDebounce = null;

    function toggleSearchBox() {
      const box = document.getElementById('search-box-expanded');
      const input = document.getElementById('header-search-input');
      const dropdown = document.getElementById('search-autocomplete-dropdown');
      if (box.style.display === 'none') {
        box.style.display = 'flex';
        input.focus();
      } else {
        box.style.display = 'none';
        input.value = '';
        dropdown.innerHTML = '';
        dropdown.style.display = 'none';
      }
    }

    function onSearchInput() {
      clearTimeout(_searchDebounce);
      const input = document.getElementById('header-search-input');
      const query = input.value.trim();
      if (query.length < 2) {
        const dd = document.getElementById('search-autocomplete-dropdown');
        dd.innerHTML = '';
        dd.style.display = 'none';
        return;
      }
      _searchDebounce = setTimeout(() => fetchAutocomplete(query), 200);
    }

    function onSearchKeydown(event) {
      const dropdown = document.getElementById('search-autocomplete-dropdown');
      const items = dropdown.querySelectorAll('.ac-item');
      const current = dropdown.querySelector('.ac-item.highlighted');
      let idx = Array.from(items).indexOf(current);

      if (event.key === 'ArrowDown') {
        event.preventDefault();
        idx = Math.min(idx + 1, items.length - 1);
        items.forEach(i => i.classList.remove('highlighted'));
        if (items[idx]) items[idx].classList.add('highlighted');
      } else if (event.key === 'ArrowUp') {
        event.preventDefault();
        idx = Math.max(idx - 1, 0);
        items.forEach(i => i.classList.remove('highlighted'));
        if (items[idx]) items[idx].classList.add('highlighted');
      } else if (event.key === 'Enter') {
        event.preventDefault();
        if (current) {
          current.click();
        } else {
          doHeaderSearch();
        }
      } else if (event.key === 'Escape') {
        toggleSearchBox();
      }
    }

    async function fetchAutocomplete(query) {
      try {
        const data = await API.get('/search/autocomplete?q=' + encodeURIComponent(query) + '&limit=8');
        renderAutocompleteDropdown(data.suggestions || [], query);
      } catch (err) {
        // Silent fail
      }
    }

    function renderAutocompleteDropdown(suggestions, query) {
      const dropdown = document.getElementById('search-autocomplete-dropdown');
      if (suggestions.length === 0) {
        dropdown.innerHTML = '';
        dropdown.style.display = 'none';
        return;
      }

      const typeIcons = {
        person: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>',
        topic: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 7h16M4 12h16M4 17h10"/></svg>',
        keyword: '<svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"/><line x1="7" y1="7" x2="7.01" y2="7"/></svg>',
      };

      let html = suggestions.map(s => {
        const icon = typeIcons[s.type] || '';
        const typeBadge = `<span class="ac-type">${s.type}</span>`;
        let onclick = '';
        if (s.type === 'person') onclick = `navigateTo('/author/${s.id}'); toggleSearchBox();`;
        else if (s.type === 'topic') onclick = `navigateTo('/topic/${s.id}'); toggleSearchBox();`;
        else onclick = `document.getElementById('header-search-input').value='${escapeHtml(s.label.replace(/'/g, "\\'"))}'; doHeaderSearch();`;
        return `<div class="ac-item" onclick="${onclick}">${icon} <span class="ac-label">${escapeHtml(s.label)}</span> ${typeBadge}</div>`;
      }).join('');

      html += `<div class="ac-item ac-item--search" onclick="doHeaderSearch()">
        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="M21 21l-4.35-4.35"/></svg>
        <span class="ac-label">Search for "${escapeHtml(query)}"</span>
      </div>`;

      dropdown.innerHTML = html;
      dropdown.style.display = 'block';
    }

    function doHeaderSearch() {
      const input = document.getElementById('header-search-input');
      const query = input.value.trim();
      if (query.length >= 2) {
        const dropdown = document.getElementById('search-autocomplete-dropdown');
        dropdown.innerHTML = '';
        dropdown.style.display = 'none';
        navigate(null, '/?search=' + encodeURIComponent(query));
      }
    }

    // Close autocomplete when clicking outside
    document.addEventListener('click', (e) => {
      const searchArea = document.querySelector('.header-search');
      const dropdown = document.getElementById('search-autocomplete-dropdown');
      if (searchArea && dropdown && !searchArea.contains(e.target)) {
        dropdown.innerHTML = '';
        dropdown.style.display = 'none';
      }
    });
  </script>
</body>
</html>
